services:
- docker
env:
  global:
  - secure: TP9V3mSAnVJuzYmgAC2UOwXTCdp3aTGKf7i8hDqAZKe4WkVdSTLqksz4Z1/Ii5kEk3UrX46D0NjTy0wPLTRgHYdqybp1psQL394gw9VPADT/ZrZR1jl+MmqHQhg8ef2HnWSVG/upoSrEb3isEiwUDAwTizPEs1jR4OSQk5J/ZBFmykXassR8giF4zOLO2OQvl0H9L8eMB35/nWqS+vUHb1AdGE45ElOQ974tFra8sydSAx32vF6IzEDEJ45Iex+w/q1sq5WqiEeGjQlcwQDxuFcY1N2OiMDwLG4pD+efUeolU3OdK1qmZ0jU8rg8Jt2d4CEw+4cu1NbbKHbcsTAGVbAqXKjpdPePbsAs2H4pFjF7XoKlSn0QCoHuv4YTAL+81UNfq3Se2HwJtiufHNq80J3mTnZdybqxKN/Xl/oOJX2QzwqAQyay4Roab88PUKh2BKAOVtqfo0njdfzxMwUoF0DAP1E+FXu6h2Fvirlqf43VbJpidit7vOfBgKh0qjlWiYC21NPGJOxV4zwElvE6m2UyxRJegrOd45eoYNaccSasqtvxGb+p9QhhWtEk3T8P1bg8rMukYDegFoSlVCRGF5v9+sT0+jVk+yrd71EN2axX+JeLVMfFWVLN49yf0LtFISECCe/JJGgnFfLMoRLKImju6XXDHm/uuEs7i+INfb8=
  - secure: jChdlwrKObp67AjFLxv4pybk4vZQ3DzkydcNflqzlaxs9FxoBi5AQ+d7d7cNAITFWpTppdt07UC7V6h7rFTVsu9G5gkpDfI5j2e3KtDo3yiI2+TwxZilh2ZEl15WqwarYMXxvlMdGyaa+emciqyhR/VG3PfBUy2ZuSa5/nI8gZjo8LDmfH0/a4QopiM5c1qoniFjxDI0XwXXXiYs5mHGbjTQxfe0raEYjVT5qqGzCBgPSIFRFjhRJcJ8ww7Xdsz9xlMwONWqQT5gl6Be+h4n/0NhNLFuO9lWkxpEquXIxBQjpnf7eISt7O5ENH2gg5fdl8fdQxt2YSPuPrLcNLrMHIphaC41kZFx+WxBmTP3Sbwi6Pk/uSYE2TBmPrLPDkHR8a8SdQ3w0KJA1nB2x5wxtonuDlORgWeHQRn5uecvqPkyUI+L2P/pmSC976lg9g8tGU6uok6XkFSGo42I56G/wjYdzbmCZOYdG2jXDaEocNMyRtiztrgoZZ1nNfI87vQJ2LLjZ86T+LwvQoU3RJN0TYCYF2MSP1++IChrhIdjVTQAb9AE+nesnUaVVI4wcdleSK1AhVyFUr0d5jbTgTwd1M1DwoScGDtF4Faozy0e7K7dOPYj2mAQiEqhoFF07lkQWW52F76QzgHYBVUeOGTxYRCulSJIoxBiEU7AXGvOY0Y=
  - secure: mB/eLt7z9tpl4F9DKPWoDaDqeLNxSrdZl7AiE0hoc9Tz89b17Js56Jn+2seKqH2EOVvqZPJVt3Tvv0qwilwrqGhiw6S/8GpeRyzMc+UAoxIqGMoZJ3X33gjFxup516P3/HLj3EHzN9YZGNHczKRGDDLHmUXEH2EGAks6EhdKAare7T53NGN5un+x1aTAaLFGjplha2X0ckJAMprB1GkcWt/ZJTNoqV1M8HXZLJX+hrvtuEEGQWd2p5BjCbY3okV/xEhv5mbswqxyhMS0yLvMsaArJr67RSGvO94/2cxoYXrYHySS9T100vOnAvUo+tSUWfV50Jne+3vX+CuPYdxme9K8E8plZm5ceBxY+8EJNN78h5wOfZ+Ft0MwapX0QL3d2519DCBJL5bLbEi4amgCkUjtDJXMDbDg3veS5Uh1PItCjZcSWADOKLDxEwFXSddLjBSARolj9Y67R4VgResPj6/Gh3IOnK3n7cau6+Nn7gqMh5hgl2NaRr6NP/5rP9T7FT6OcdqnFHu+YkemmzzTxZm+14/BzKR+aBG1i1WoybaHfDYc71ynTeAMfWysUUVQmJnBf/gzj8Vz/b96W7SmmLmTfzQ8ZbeU2CCqgVVxsdvIWKlK/4gIjnYT5w6yhgC4XpKHSDrMJ+IpIxeuPzR81j9hroHjfhkzxELSjLjxbX8=
  - secure: epiUwtY61ipALmWhfo+0JkRTaItcu7ua8clX1GfoZYMlFl0RrKmQRfeDxXRBzugzGgdkhzFwj3eWJ2y0HKg8th1m81NvRHPLoNs3sz4r5dQabhPPQhc5uihmY2TfI75pixetnsn/1BMSrz4ld05bAemPS3yOtbdNQMSA4AjN7jfAHBopbSyNXAvzLS64ppmwMRFnQmstE1dp3q7xCyybVMkzV9styGspAoEP/DXYb+wIBMn/nP5SSKhZUfkGKBRclTXim9AjDSAtSISzgwYyqT/puNmBUe8A0byk/i4reOUdl1av8Oo7BgHkOwOyWPQAwfKAtLxj4Lo2AUqxukb06L7LY9xaMRw1MosoHcylsFyqqvFVe6YjCb4c1i6h8yrkzgcsow1IVc7d1iCxcesWaaSAMm+3FcIAvXlJ7b7lE6REJYv047HdKchyi92A4sav6Wj92VKNB9iakRXYsfWHJM6NO/5jAgqtpl6VPB3Iwo6fUB3qf60PsDaxAwCicAQzYw40QOsGLvjQ0wPVMYUga8EFiZO/vZP9StGExgq0+vZ8LK1BirQ+wGQdm7l1HUywlbT36YIBFol+7fE239NFxNLNEaQyXJjCg3Pe0HbHA9/rOLCCA5PBdpHSc5Dcj5S4sSgvgIar7/Vv42plcUJI3n28U/Ie3Wujc2flPHsAL0A=
 
  - DOCKER_USERNAME=olutiab
  - DOCKER_PASSWORD=
 
  - secure: M0c6J193KYGEC2KdzSGuzs/05APm9SDzQOQ5Vq2cfxtb5pPOHoYjB1llA0056QHBcBjMJ/Md6o6mrQm4kLlXStczfphYb7KSM0em4KeQUhF0BE2TuS2EFEATy3rpIslfa+TeWxAGhIJegvMNGT99ec+4iBGcPRQYLmLu3AO2duC7YB0wU3YRYq5VuHPvL2JYi0qqeMrr29BlX0NHN18UaMGN2gPHQUDGH3RNKs4p3Bnb70tje4PRyZVhH+4wxakYdx47KBNziIdthfZ/lpYrWtDqfcWn+w3lUOjeadxMDYcZzPT7jycs5k6eLn+Js9QO1AdWPMvt7zdy7vmsUtqIhGIID0Sj6IW/fWk3B0P9z2IajbGHZbNWM8/NAw+mK30cWRe6LLR3m8dZ/YnHD2eZjG6N2E2g5EnIWpTis9GeEVGm9vHW/s6vRYO2VriD6Rc9hIuZrOC6piWN+MemXM8s9vhuScmYNh1XnDk76vBXhBeelv6ov8HRl1654LS3ydVem7UbHvX4299DsYdUq9H55gbPCIfNV9lUes2+CG+7mW7TMJGaIN1dzk3FEgiaTmEzHO36I1mNvaXjep0/UFS9NljZm/EfY0G0sUY968OCmhlEDTNhMhkshwAxjpv8SdsLs6+2Ywy8mHnqYH/fIsrIFG0AaiOaUPiXy9xJUxtkZTQ=
 
  - HEROKU_API_KEY=
  - secure: hvvkAPY2iPtpqbIQ0OkutUEVyzSQ24vUiBrThYvndv8WazbCAt98nVWFYwI7pF8qq/8/rdni1bEuT+4C1tCnJ2W9cv3BNkzbjE5L41VNhTgrUCFED+KAsiFBTWML+1GtgYz7hlpJiHNGkQzCl5+Mue2z6mXeydfuV0Wsilfuh7VsMdIDWjoZrLaUNoNrF81RTIAVmdJKlnkbhdGNe3+AGLosxF6MNtbeLvQ/TcxQakmlaS/V4/c39wGNKcNxqxC1vbDVXKJKCNxzbBlTb7O5jBMoGxiN3e2GjMBzVF+TZl4YJX4EPa7EX7qkUeVcxxxYOTZ4bHTORN02oB5vAwBRL+Oy8/9v1IzoC1r3m4W62MPuC3ICI03X1+/aJB6xIyOc8Yf0jH+9Kk5uyN6GfS2KJWPJrbVy2PvA7RS0LidG+2lw7rUstL7GKq7gbXucJXzX7LaEV2H8LitOo4mI1V/yOz3gS1aWsTtmdcBm+pcEQK3XJhqReoweVn73zd1XKJNui1vxqd+paQxwd3zHAtBjQSs0dw8ejF0Uz84uY0Ilptw0ntFIdJK0EnncxN04qkuGb06ca1y1P7gTajX+3MQ2JhD32tScnPvblWpODoVfHjabcCQYguqdiR/NtDl/FDquTNPDYUGP9Z3aRaKK2zBV2PTBm/W7j2OJ+53sAbv5ZYg=

script:
- echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin

- docker pull olutiab/my-heroku-build
- docker build --target test --tag my-test-image .

- docker run my-test-image tests/test_view_model.py
- docker run my-test-image tests/test_integration.py
- docker run -e TRELLO_API_KEY -e TRELLO_API_TOKEN my-test-image tests/test_selenium.py

- docker build --target production --tag olutiab/my-heroku-build .

- docker tag olutiab/my-heroku-build registry.heroku.com/olutiab-todo-app/web

- docker push registry.heroku.com/olutiab-todo-app/web
deploy:
  provider: heroku
  api_key:
    secure: pxL7kmi1Xs5rvpkm/zAA7V6YXDo2DeFWZ5yrAvl3gsfZn4HFok5hBnW35+D66iEF9kD95VucfG8E2J12WL+5wP/kTwqTlAUjLczzi5XbaCLu+cjbIGOS8aJ6TQbK3NesXISQ0kKjufROs29XQtHLo9Dp+tMmU+pDSfDokGXwYGqopdrOqha09aa8P2CzKTGxqzZUfaOs2/Zy4xF1pAZ+t7KdAHUePHAMtIu7OLJg7dTQgkKmRK5wEbMlpadNoBtjVriuqGIXPwGnYHJwnBNXXm80jzWCUYb4/HYZGyIhZr7GPumEwfxs2pym702EM9fJzVz7mpe2rQeUbwki9T58yh7EgEH+FsxOH1ILZrK3EJnrfxvgMIa1616yAXe1r0Nk1rzFFhMzABuBwHE/RdIQWbUuFi4TAdU91pvYrc5drMQiiU/xkoGEcrnTVtAbYL7oggE9nQ9DYSekLr2Jg8V4y6kezrSVb4pG32OPkqUAo0ksBG9Kxn4F1kz+SBT8tuEuVIHdWTZDt6noBEh7TUuzzP2ObNC03PfMU81z4TG1VKPsrHSm2ZvFgOLtfi13ITtSjAbLBCe9SKNlNy3gP6q8sRjEkoLJ6/nr1VVh4dF151l+5Z0+wbVmjSk38Y6vyYOgCBMtfuWJWjcxLnLGOFjg7lVoSW3hrRJBKe3nKG9OdFw=
api_key:
- docker login --username=olutiab --password=3b56d31d-a81a-4f4a-a5ae-dd35a05293e2 registry.heroku.com

# - docker push registry.heroku.com/olutiab-todo-app/web
- heroku container:release web --app olutiab-todo-app

notifications:
  slack:
    rooms:
      secure: Hvd3Bwb/KQZOryKZrNWArkURfHT2XGJRpeV4/GelxcyULdlq+pqY0dyJXAf6NhGDPJswYMT6wxdyVwG0L+/i5PFeD/80Jv6bmbOK2My88sAlEFu/wOq3nbzjS6/pJX6ANqhpMJmT5vCoF6q08q0nVKZ9/B/S9ogHW/yI5yhnOF6Hr8q9XQ2rQSPydl+NQ6AuaMPLpChhybtKTVWuT9ATneG6EugZGs4yYIkLpuAPXB0jqhTYq5+synbETLmbJMY+Ty3iRAJMX6ov8Nawdk8NrxlBNbG9lB0GOKjUudjklUN2vw0Hdsj9b6ffBeEUMj95c37URFy0m0VCH9afRyhC1RopCAzRmnTsPebpdaL/69e9AjlXYHDfX31LbRsDO/rxMU3JD+q+AUNPEkrE/saKSFh7J05ufXuaxMmDrOhD0qe8aC28CI/gOrFcJtrLdrzieeaVZH+GTYn8C3Z7FQAOUV/JnQ7+mUefARZg1n50uP8Y5yyJ4t0CaTM6V9A/szKJBqvjxCvxjch3B2cPK0gGOB18Czb9oqkSsIBKqaeMxoOhQgXKYEKKjmC2cPIqjxpxY1lFLjs17Au4CiJhvsz8jnP6l1xr6Om5YVhQjycrN31yjhSaopjpGKiYCWYbc7jhCE7ejfWNS/LG54TlWHJaBf8Q1il2Zm+CUK9MPFls56M=
  email:
    recipients:
    - yomi.olutimehin@yahoo.com
    on_success: never
    on_failure: always
