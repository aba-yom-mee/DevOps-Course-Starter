services:
- docker
env:
  global:
  - secure: TP9V3mSAnVJuzYmgAC2UOwXTCdp3aTGKf7i8hDqAZKe4WkVdSTLqksz4Z1/Ii5kEk3UrX46D0NjTy0wPLTRgHYdqybp1psQL394gw9VPADT/ZrZR1jl+MmqHQhg8ef2HnWSVG/upoSrEb3isEiwUDAwTizPEs1jR4OSQk5J/ZBFmykXassR8giF4zOLO2OQvl0H9L8eMB35/nWqS+vUHb1AdGE45ElOQ974tFra8sydSAx32vF6IzEDEJ45Iex+w/q1sq5WqiEeGjQlcwQDxuFcY1N2OiMDwLG4pD+efUeolU3OdK1qmZ0jU8rg8Jt2d4CEw+4cu1NbbKHbcsTAGVbAqXKjpdPePbsAs2H4pFjF7XoKlSn0QCoHuv4YTAL+81UNfq3Se2HwJtiufHNq80J3mTnZdybqxKN/Xl/oOJX2QzwqAQyay4Roab88PUKh2BKAOVtqfo0njdfzxMwUoF0DAP1E+FXu6h2Fvirlqf43VbJpidit7vOfBgKh0qjlWiYC21NPGJOxV4zwElvE6m2UyxRJegrOd45eoYNaccSasqtvxGb+p9QhhWtEk3T8P1bg8rMukYDegFoSlVCRGF5v9+sT0+jVk+yrd71EN2axX+JeLVMfFWVLN49yf0LtFISECCe/JJGgnFfLMoRLKImju6XXDHm/uuEs7i+INfb8=
  - secure: jChdlwrKObp67AjFLxv4pybk4vZQ3DzkydcNflqzlaxs9FxoBi5AQ+d7d7cNAITFWpTppdt07UC7V6h7rFTVsu9G5gkpDfI5j2e3KtDo3yiI2+TwxZilh2ZEl15WqwarYMXxvlMdGyaa+emciqyhR/VG3PfBUy2ZuSa5/nI8gZjo8LDmfH0/a4QopiM5c1qoniFjxDI0XwXXXiYs5mHGbjTQxfe0raEYjVT5qqGzCBgPSIFRFjhRJcJ8ww7Xdsz9xlMwONWqQT5gl6Be+h4n/0NhNLFuO9lWkxpEquXIxBQjpnf7eISt7O5ENH2gg5fdl8fdQxt2YSPuPrLcNLrMHIphaC41kZFx+WxBmTP3Sbwi6Pk/uSYE2TBmPrLPDkHR8a8SdQ3w0KJA1nB2x5wxtonuDlORgWeHQRn5uecvqPkyUI+L2P/pmSC976lg9g8tGU6uok6XkFSGo42I56G/wjYdzbmCZOYdG2jXDaEocNMyRtiztrgoZZ1nNfI87vQJ2LLjZ86T+LwvQoU3RJN0TYCYF2MSP1++IChrhIdjVTQAb9AE+nesnUaVVI4wcdleSK1AhVyFUr0d5jbTgTwd1M1DwoScGDtF4Faozy0e7K7dOPYj2mAQiEqhoFF07lkQWW52F76QzgHYBVUeOGTxYRCulSJIoxBiEU7AXGvOY0Y=
  - DOCKER_USERNAME=olutiab
  - HEROKU_LOGIN=yomi.olutimehin@yahoo.com
  - DOCKER_PASSWORD: 
  - secure: oneR8r799EUXy9md8DT+9tYYm4Y87JFj2UbumWERBTyxNiIeI5vbk5NopHsLCbAWNBhaJkBfg7y98rCB4fST7aax4M1VmjiLMmfsWO1dXM245B4jK82v+ZAHM+OvIxr09vt6S/X+uvV21BheK0QQ/U1cFxYJRH+cu8XCDrGbnFI81wmvyv+UFULNWHk11d+SfvnsbYhVmXY+3EpyWa1dBeAad/F8g9QZ+/LtTWLczRFJvuRKIwBuQvEWrmXWa2y0DK0M+hb929tyhBY2YNTGtnuL85UQpTfXVmH4iqYRNhO6D6DUEhVyGl1mF8NA6jJRTynRdD267jAFz/WO8TlH9Kz5XxIOVDZW0OdzoiRKybHwS5Xpxf385sJc+lqQlu23ZFBAY1IeXg745U3Bj3u1QKTlGYTpmvg39bQQE0R3+LXtjDvUTDg3aGmCkSovCMO1ffQQ/fv+UycApsqpe108fHuZcspxpRoxW+OS23WJ1iu6IpKR96Kp5zem58JoKadOXpm9mfMCGevP8r6EvPjlRTQfaW5MoBk0Hw5/YHnH983FyZqkn6zo3wla0e5LWHLIsMq0jYzqXeLqFU0hjCB+OxJ9XrruJA+3yVncHDBugV8UGY7VsN1Cp5UDn/q+YLxgAClIk/Qmegyg1if2/2UB6W7/DDSArXKnb22xBXRuA/k=
  HEROKU_API_KEY:
    secure: egahHV2U+VTHG8x2BQFjT4msLWUHqyrTDqeaZd7Ru9i5LDycnTabn07o/jnn5Nb29P4cXXwalhHCmhjVR5xYqdg4P3xQvMWUj89F4iz6yMebTch1eALGfUV2RShbxGG4TV+2TyBHTH6tIuoqbGjN+GcM9jNVRws8z4lS1naRtxR1flC+3ZVqHLA0gWNvUZsmYoRFnwPZFrc5Jmb4GKxz8B9RSxdU/QMPgP/pFm79OXwaHd6cl1PN/IhGBMC0Tg+TdDtQie5A5M4+l7iLOgJcy1wiVOZuo1N96dDQlpFjaGuaLjvkGgOvjPuZor/eEef+fZUm3ur/OLwFWGnzrYENQxhbyTrgp79X5V4695SbsyNjZHppQSlGRXG8WpRS0wm/R8D6hP2uZ/yTQe+kNf1El/2L9/PC9lPFVeYm9ZAsMZ89Y3EZW6GDmlP9SJtHBYNmEKGCSC30Ph8RCtoz0aqR7MAOfWvscKZtXUgZgxm02wf/aMoOwMFCYV63OAQYwovHSqgS8l1MgZbuMRQbkxU+ZzQa6JbdFUR0nTGQAHt62ZyAk+Hk9SmrAchFDmEmJn12LDLh46omqXwO2i9g8JpsfyufqlOqxs3T6g5cIt87ykvscHGhhPyvFZC+30pu7gd1zijJLMkWb9Pko1UIXqsOHCEAzHwA/Oix8Wu17eTeM4w=
  HEROKU_API_PASSWORD:
    secure: pM77RBgG322Uhr2tJdY7ChRz/LL75UwD6/Ad+1cwJtsESClcJR4044iiGOh5xYYIaJCtQk5hM6tGYtGWbJGJahZ8InTWSAUiVEhiQ/qHvxU9XXwDwFd1f6y9RVElE4PNhweKzXQC7xKa1JCe1RyqczePd4Ecf1MX4BlgYyecD6MNPixo92p1m/wGpuphaRedBPCWmnC2zc5I9meyxj1PSxFuj5n7gjoDUq29fX+fU7AHTsZvIOu7qYCtBATcu7E16RKk0mxPGwdN0HIm+6WaAUL5hYU3Orb1SoV3A2s/CsMzcOJduL9qKvpH4nyvOALn8DYx+k0lQzkLnC1QcF0il5Q1stiek8ba5k8RX49S5ZmFOBXLwK2NoPJq+Sqabo3Ry+tQEu9jY42WLk/RbXUaJyzzcQNgKL0a5ulUwemXI9XvE9Nb/EtTPS7zMb0O8SI7vcgs8zCw/H764fYWRxPThSy41QBMeHa6gJi+JnPoplp6/n9zSCdZK7prFs13N0dHB+klAg8UHNEwQC9mWnynxy6+xuFmAHuZs54YGSyUR0U/n5Q/rQZliOUgTWspStDBwben7xdVYXT+ISffy99WxmkTfHO8UgNPFI7gI91M0wqk/lYfjY6IzrbVS/CjOuJdDD49LykCNbpFbbRJyV9eM719giQNqGmEmfwghzmxsXA=
script:
- echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
# - docker pull olutiab/my-heroku-build
# - docker pull olutiabolutiab/olutiab-todo-app
- docker build --target test --tag my-test-image .
- docker run my-test-image tests/test_view_model.py
- docker run my-test-image tests/test_integration.py
- docker run -e TRELLO_API_KEY -e TRELLO_API_TOKEN my-test-image tests/test_selenium.py

deploy:
  provider: script

  overwrite: true
  skip_cleanup: true
  script: bash scripts/deploy.sh 
  on:
    all_branches: true

notifications:
  slack:
    rooms:
      secure: Hvd3Bwb/KQZOryKZrNWArkURfHT2XGJRpeV4/GelxcyULdlq+pqY0dyJXAf6NhGDPJswYMT6wxdyVwG0L+/i5PFeD/80Jv6bmbOK2My88sAlEFu/wOq3nbzjS6/pJX6ANqhpMJmT5vCoF6q08q0nVKZ9/B/S9ogHW/yI5yhnOF6Hr8q9XQ2rQSPydl+NQ6AuaMPLpChhybtKTVWuT9ATneG6EugZGs4yYIkLpuAPXB0jqhTYq5+synbETLmbJMY+Ty3iRAJMX6ov8Nawdk8NrxlBNbG9lB0GOKjUudjklUN2vw0Hdsj9b6ffBeEUMj95c37URFy0m0VCH9afRyhC1RopCAzRmnTsPebpdaL/69e9AjlXYHDfX31LbRsDO/rxMU3JD+q+AUNPEkrE/saKSFh7J05ufXuaxMmDrOhD0qe8aC28CI/gOrFcJtrLdrzieeaVZH+GTYn8C3Z7FQAOUV/JnQ7+mUefARZg1n50uP8Y5yyJ4t0CaTM6V9A/szKJBqvjxCvxjch3B2cPK0gGOB18Czb9oqkSsIBKqaeMxoOhQgXKYEKKjmC2cPIqjxpxY1lFLjs17Au4CiJhvsz8jnP6l1xr6Om5YVhQjycrN31yjhSaopjpGKiYCWYbc7jhCE7ejfWNS/LG54TlWHJaBf8Q1il2Zm+CUK9MPFls56M=
  email:
    recipients:
    - yomi.olutimehin@yahoo.com
    on_success: never
    on_failure: always
